/* 
   XPECT_SETUP org.uqbar.project.wollok.tests.interpreter.WollokXPectInterpreterTestCase END_SETUP
   XPECT interpret 
*/

class Bird {
	var energy = 100
	
	invariant energy >= 0
	
	method fly(kms) {
		energy -= kms
	}
}

class AnotherBird inherits Bird {
	method doSomething() {
		energy = -10
	}
}

class BigBird inherits Bird {
	invariant energy >= 10 : 'A big bird needs to always have at least 10 points of energy'
}

test "invariant gets checked for subclasses when calling inherited method" {
	const b = new AnotherBird()
	assert.throwsExceptionWithMessage("Violated invariant: Not satisfied (energy >= 0)", { =>
		b.fly(200)
	})
}

test "invariant gets checked for subclasses when calling a subclass method" {
	const b = new AnotherBird()
	assert.throwsExceptionWithMessage("Violated invariant: Not satisfied (energy >= 0)", { =>
		b.doSomething()
	})
}

test "all invariants are checked from the hierarchy" {
	const b = new BigBird()
	assert.throwsExceptionWithMessage('Violated invariant: A big bird needs to always have at least 10 points of energy (energy >= 10)', { =>
		b.fly(95)		
	})
}